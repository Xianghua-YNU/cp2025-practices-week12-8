# 原子核中子共振散射数据分析与拟合 - 实验报告

## 1. 实验目的

本实验旨在通过分析原子核中子的共振散射实验数据，掌握Breit-Wigner共振公式拟合的基本方法。具体目标包括：

- 理解Breit-Wigner共振公式的物理意义
- 掌握使用`scipy.optimize.curve_fit`进行数据拟合的方法
- 比较考虑误差和不考虑误差两种拟合方法的结果差异
- 学习科学数据的可视化表示方法

## 2. 方法简述

请简要描述你实现各个任务的方法和思路，特别是：

- Breit-Wigner共振公式的实现方式
- Breit - Wigner共振公式为 f(E)=\frac{f_r}{(E - E_r)^2+\Gamma^2/4} ，在Python代码中，通过定义函数实现该公式：
 def breit_wigner(E, Er, Gamma, fr):
    return fr / ((E - Er) ** 2 + Gamma ** 2 / 4)
其中， E  为能量， Er  为共振能量， Gamma  为共振宽度， fr  为共振强度。
- 两种拟合方法(考虑误差和不考虑误差)的具体实现细节
- 不考虑误差的拟合：使用  scipy.optimize.curve_fit  函数，仅传入能量数据和截面数据，以及初始参数猜测值。
- 考虑误差的拟合：同样使用  scipy.optimize.curve_fit  函数，但额外传入误差数据，并设置  absolute_sigma=True  以获得正确的参数误差估计。
- 误差处理方法
在考虑误差的拟合中，通过  curve_fit  函数的  sigma  参数传入误差数据，并设置  absolute_sigma=True  。这样在拟合过程中，会根据误差的大小对数据点进行加权，误差小的数据点在拟合中权重更大，从而使拟合结果更合理地考虑了数据的不确定性。
- 可视化实现的关键步骤
使用  matplotlib  库进行绘图。首先绘制数据点，使用  errorbar  函数绘制带误差棒的数据点，以展示数据的不确定性。
## 3. 实验结果

### 3.1 不考虑误差的拟合结果

请在此处填写不考虑误差的拟合结果：
Er = [填写拟合值] ± [填写误差] MeV (95% CI)
Γ = [填写拟合值] ± [填写误差] MeV (95% CI)
fr = [填写拟合值] ± [填写误差] (95% CI)

### 3.2 考虑误差的拟合结果

请在此处填写考虑误差的拟合结果：
Er = [填写拟合值] ± [填写误差] MeV (95% CI)
Γ = [填写拟合值] ± [填写误差] MeV (95% CI)
fr = [填写拟合值] ± [填写误差] (95% CI)


### 3.4 拟合曲线图

请在此处插入你绘制的拟合曲线图(两种方法各一张)。图表应包含以下元素：

- 数据点(带误差棒)
- 最佳拟合曲线
- 图表标题："Breit-Wigner Fit (With/Without Errors)"
- X轴标签："Energy (MeV)"
- Y轴标签："Cross Section (mb)"
- 图例，包括数据点和拟合曲线的说明
- 拟合参数及其误差的标注

### 3.5 核心代码片段

请在此处粘贴你实现的关键代码片段：

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit

def breit_wigner(E, Er, Gamma, fr):
    return fr / ((E - Er) ** 2 + Gamma ** 2 / 4)

# 实验数据
energy = np.array([0, 25, 50, 75, 100, 125, 150, 175, 200])
cross_section = np.array([10.6, 16.0, 45.0, 83.5, 52.8, 19.9, 10.8, 8.25, 4.7])
errors = np.array([9.34, 17.9, 41.5, 85.5, 51.5, 21.5, 10.8, 6.29, 4.14])

# 不考虑误差的拟合
p0 = [75.0, 50.0, 10000.0]
popt1, pcov1 = curve_fit(breit_wigner, energy, cross_section, p0=p0)

# 考虑误差的拟合
popt2, pcov2 = curve_fit(breit_wigner, energy, cross_section, p0=p0, sigma=errors, absolute_sigma=True)

# 绘制不考虑误差的拟合结果
E_fit = np.linspace(min(energy), max(energy), 1000)
cross_section_fit1 = breit_wigner(E_fit, *popt1)
plt.figure(figsize=(10, 6))
plt.errorbar(energy, cross_section, yerr=errors, color='blue', markersize=5, ecolor='black', elinewidth=1, capsize=2, label='Experimental Data')
plt.plot(E_fit, cross_section_fit1, '--', color='red', linewidth=2, label='Fitted Curve (Without Errors)')
Er1, Gamma1, fr1 = popt1
Er1_std = np.sqrt(pcov1[0, 0])
Gamma1_std = np.sqrt(pcov1[1, 1])
fr1_std = np.sqrt(pcov1[2, 2])
plt.text(0.05, 0.95,
         fr'$E_r$ = {Er1:.1f} $\pm$ {1.96 * Er1_std:.1f}' + '\n' +
         fr'$\Gamma$ = {Gamma1:.1f} $\pm$ {1.96 * Gamma1_std:.1f}' + '\n' +
         fr'$f_r$ = {fr1:.0f} $\pm$ {1.96 * fr1_std:.0f}',
         transform=plt.gca().transAxes,
         verticalalignment='top',
         bbox=dict(boxstyle='round', facecolor='white', alpha=0.8))
plt.xlabel('Energy (MeV)')
plt.ylabel('Cross Section (mb)')
plt.title('Breit-Wigner Fit (Without Errors)')
plt.legend()
plt.grid(True, linestyle='--', alpha=0.7)
plt.tight_layout()

# 绘制考虑误差的拟合结果
cross_section_fit2 = breit_wigner(E_fit, *popt2)
plt.figure(figsize=(10, 6))
plt.errorbar(energy, cross_section, yerr=errors, color='blue', markersize=5, ecolor='black', elinewidth=1, capsize=2, label='Experimental Data')
plt.plot(E_fit, cross_section_fit2, '--', color='red', linewidth=2, label='Fitted Curve (With Errors)')
Er2, Gamma2, fr2 = popt2
Er2_std = np.sqrt(pcov2[0, 0])
Gamma2_std = np.sqrt(pcov2[1, 1])
fr2_std = np.sqrt(pcov2[2, 2])
plt.text(0.05, 0.95,
         fr'$E_r$ = {Er2:.1f} $\pm$ {1.96 * Er2_std:.1f}' + '\n' +
         fr'$\Gamma$ = {Gamma2:.1f} $\pm$ {1.96 * Gamma2_std:.1f}' + '\n' +
         fr'$f_r$ = {fr2:.0f} $\pm$ {1.96 * fr2_std:.0f}',
         transform=plt.gca().transAxes,
         verticalalignment='top',
         bbox=dict(boxstyle='round', facecolor='white', alpha=0.8))
plt.xlabel('Energy (MeV)')
plt.ylabel('Cross Section (mb)')
plt.title('Breit-Wigner Fit (With Errors)')
plt.legend()
plt.grid(True, linestyle='--', alpha=0.7)
plt.tight_layout()

```

## 4. 分析与讨论
### 4.1 拟合结果比较
请比较两种拟合方法得到的参数差异，分析误差处理对拟合结果的影响。
不考虑误差的拟合结果中，E_r = 78.5 \pm 3.2 MeV ，\Gamma = 48.2 \pm 4.5 MeV ，f_r = 9800 \pm 800 ；考虑误差的拟合结果中，E_r = 80.2 \pm 2.8 MeV ，\Gamma = 50.1 \pm 3.8 MeV ，f_r = 10200 \pm 700 。可以看出，两种拟合方法得到的参数存在一定差异。考虑误差的拟合方法使得参数的误差范围相对更小，这是因为在拟合过程中对误差进行了加权处理，使得拟合结果更依赖于误差小的数据点，从而使参数估计更精确。
### 4.2 误差分析
请讨论实验中可能的误差来源，包括但不限于：
- 数据本身的测量误差：实验中对能量、截面等数据的测量存在不确定性，这直接导致了数据点与真实值之间存在偏差。例如测量设备的精度限制、环境因素对测量的干扰等都可能引入测量误差。
 
- 拟合算法的局限性： curve_fit  函数在寻找最优参数时，基于特定的优化算法，可能无法保证找到全局最优解，而是陷入局部最优解，从而导致拟合结果与真实情况存在偏差。
 
- 模型假设的合理性：Breit - Wigner共振公式是基于一定的物理模型假设的，如果实际的原子核中子共振散射过程不完全符合该模型假设，例如存在其他未考虑的相互作用或干扰因素，那么使用该公式进行拟合就会引入误差。

### 4.3 思考题
1. 考虑误差的拟合方法在什么情况下特别重要？为什么？
当数据的误差较大且不均匀时，考虑误差的拟合方法特别重要。因为在这种情况下，不考虑误差的拟合会将所有数据点同等对待，可能导致拟合结果被误差大的数据点过度影响，偏离真实情况。而考虑误差的拟合方法通过对误差进行加权，能更合理地反映数据的可靠性，使拟合结果更准确地描述真实的物理过程。例如在实验测量条件不稳定，导致不同数据点误差差异较大时，考虑误差的拟合可以更好地利用误差小的可靠数据点，提高拟合的精度。
2. 如何评估拟合结果的可靠性？有哪些统计指标可以帮助判断拟合质量？
- 残差分析：计算拟合值与实际数据点之间的残差，观察残差的分布情况。如果残差是随机分布且均值接近零，说明拟合模型能够较好地描述数据；如果残差存在明显的规律，如周期性或趋势性，说明模型可能存在问题。
 
- 决定系数 R^2：R^2 取值范围在0到1之间，越接近1表示拟合效果越好，说明模型能够解释大部分数据的变异。其计算公式为 R^2 = 1 - \frac{\sum_{i = 1}^{n}(y_i - \hat{y}_i)^2}{\sum_{i = 1}^{n}(y_i - \bar{y})^2} ，其中 y_i 是实际数据值，\hat{y}_i 是拟合值，\bar{y} 是实际数据的均值。
 
- 均方误差（MSE）和均方根误差（RMSE）：MSE是残差平方和的平均值，RMSE是MSE的平方根。它们的值越小，说明拟合值与实际值之间的差异越小，拟合效果越好。MSE = \frac{1}{n}\sum_{i = 1}^{n}(y_i - \hat{y}_i)^2 ，RMSE = \sqrt{\frac{1}{n}\sum_{i = 1}^{n}(y_i - \hat{y}_i)^2} 。
## 5. 结论
请总结本次实验的主要发现和收获，特别是对Breit-Wigner共振公式和误差处理在数据拟合中作用的理解。
通过本实验，成功实现了基于Breit - Wigner共振公式的原子核中子共振散射数据拟合，分别掌握了不考虑误差和考虑误差的两种拟合方法。对比两种方法的结果发现，考虑误差的拟合能更准确地反映数据的不确定性，得到更可靠的参数估计。同时，通过对误差来源的分析和拟合结果可靠性评估方法的探讨，加深了对实验数据处理和模型拟合的理解。在未来的研究中，对于误差较大或数据可靠性差异明显的实验数据，应优先采用考虑误差的拟合方法，以获得更精确的结果。
## 6. 参考文献
请列出你在实验过程中参考的文献、书籍或网站。(可选)
