# 超新星数据拟合哈勃常数

## 项目背景

哈勃定律是宇宙学中的一个基本规律，描述了星系的后退速度与其距离之间的线性关系。这一关系由美国天文学家埃德温·哈勃（Edwin Hubble）于1929年首次发现。哈勃定律可以表示为：

$$v = H_0 \times d$$

其中：
- $v$ 是星系的后退速度（通常以km/s为单位）
- $d$ 是星系的距离（通常以Mpc为单位，1 Mpc = 3.26×10^6光年）
- $H_0$ 是哈勃常数，表示宇宙膨胀的速率（通常以km/s/Mpc为单位）

哈勃常数的精确测量对于理解宇宙的年龄、大小和演化至关重要。在本项目中，我们将使用Ia型超新星的观测数据来拟合哈勃常数。Ia型超新星是一种标准烛光（standardizable candles），其绝对亮度几乎相同，因此可以通过测量其视亮度来确定其距离。

2010年，Amanullah等人在论文《Spectra and Hubble Space Telescope Light Curves of Six Type Ia Supernovae at 0.511 < z < 1.12 and the Union2 Compilation》中发布了一个包含约500个Ia型超新星的数据集。这个数据集被广泛用于宇宙学参数的测量。在本项目中，我们将使用一个简化版的数据集来拟合哈勃常数。

## 项目任务

在本项目中，你需要完成以下任务：

1. **数据加载与预处理**：
   - 实现`load_supernova_data`函数，从文件中加载超新星数据，包括红移、距离模数和误差。
   - 数据文件格式为CSV，包含三列：红移z、距离模数μ、距离模数误差σ_μ。
  
data = pd.read_csv(file_path, sep='\t', header=None, names=['z', 'mu', 'sigma_mu'])  
mask = (data['z'] > 0) & (data['sigma_mu'] > 0)  
return data[mask].values.T  

2. **哈勃常数拟合**：
   - 实现`hubble_fit`函数，使用最小二乘法拟合哈勃常数。
   - 考虑距离模数的误差，进行加权最小二乘拟合。
   - 返回拟合得到的哈勃常数及其误差。
<img width="662" alt="截屏2025-05-17 21 31 06" src="https://github.com/user-attachments/assets/3aa71813-6727-474a-8b35-7f8666176804" />



3. **哈勃图绘制**：
   - 实现`plot_hubble_diagram`函数，绘制哈勃图（距离模数vs红移）。
   - 在图上显示数据点（带误差棒）和最佳拟合曲线。
   - 在图上标注拟合得到的哈勃常数值。
   - 

## 数据说明

提供的数据文件`supernova_data.txt`包含以下列：

- 第一列：红移z
- 第二列：距离模数μ（单位：等）
- 第三列：距离模数误差σ_μ（单位：等）

其中，距离模数μ与距离d（单位：10pc）的关系为：

$$\mu = 5 \log_{10}(d) - 5$$

<img width="661" alt="截屏2025-05-17 21 32 07" src="https://github.com/user-attachments/assets/dc0080c4-a390-4b38-a815-49d0e7b5d46f" />
<img width="541" alt="截屏2025-05-17 21 31 12" src="https://github.com/user-attachments/assets/81988ab5-58ef-48ac-aa80-35f0faec9036" />

## 物理背景与拟合模型

### 红移与距离的关系

在宇宙学中，红移z与后退速度v（当v << c时）的关系为：

$$v = c \times z$$

其中c是光速（约为299792.458 km/s）。

对于较大的红移，需要考虑相对论效应，此时关系变为：

$$v = c \times \frac{(1+z)^2-1}{(1+z)^2+1}$$

但在本项目中，我们主要关注低红移区域（z < 0.2），此时可以使用线性近似。

### 距离模数与红移的关系

在宇宙学中，光度距离$d_L$与红移z的关系可以通过泰勒展开表示为（对于低红移）：

$$d_L = \frac{c}{H_0} \times z \times \left(1 + \frac{1}{2}(1-q_0)z\right)$$

其中$q_0$是减速参数。在本项目中，为了简化，我们将使用以下模型：

$$d_L = \frac{c}{H_0} \times z \times \left(1 + \frac{1}{2}(1-a_1)z\right)$$

其中$a_1$是一个拟合参数，对应于减速参数$q_0$。

将光度距离代入距离模数公式，并考虑到距离单位的转换（从Mpc到10pc），我们得到：

$$\mu = 5\log_{10}\left(\frac{c \times z}{H_0} \times \left(1 + \frac{1}{2}(1-a_1)z\right) \times 10^6 \times \frac{3.26}{10}\right)$$

简化后，我们得到：

$$\mu = 5\log_{10}\left(\frac{c \times z}{H_0} \times \left(1 + \frac{1}{2}(1-a_1)z\right)\right) + 25$$

其中，常数25来自于距离单位的转换。

### 拟合方法

在本项目中，我们将使用`scipy.optimize.curve_fit`函数或者`lmfit`模块进行加权最小二乘拟合。该函数通过最小化以下目标函数来确定最佳参数：

$$\chi^2 = \sum_{i} \frac{(\mu_i - \mu_{model}(z_i, H_0))^2}{\sigma_{\mu,i}^2}$$

其中：
- $\mu_i$是第i个超新星的观测距离模数
- $\mu_{model}(z_i, H_0)$是模型预测的距离模数
- $\sigma_{\mu,i}$是距离模数的测量误差

为了简化，我们可以使用以下模型进行拟合：

$$\mu = 5\log_{10}\left(\frac{c \times z}{H_0}\right) + 25$$

这相当于假设 $a_1 = 1$（或 $q_0 = 0$）。

通过对观测数据进行拟合，我们可以得到哈勃常数 $H_0$的估计值及其不确定度。

## 提交要求

1. 提交测试通过的`supernova_hubble_fitting_student.py`
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit

# 光速（km/s）
C = 299792.458  
# 常数项（来自距离单位转换：1 Mpc = 3.26e6光年 = 3.08568e24 cm，10pc = 3.08568e19 cm）
CONSTANT_TERM = 25  

def load_supernova_data(file_path):
    """加载并预处理超新星数据"""
    data = pd.read_csv(file_path, sep='\t', header=None, names=['z', 'mu', 'sigma_mu'])  # 假设数据用制表符分隔
    # 剔除无效数据（红移或误差为负）
    mask = (data['z'] > 0) & (data['sigma_mu'] > 0)
    return data[mask].values.T  # 返回z, mu, sigma_mu的数组

def hubble_model(z, H0):
    """哈勃定律模型（简化版：mu = 5*log10(c*z/H0) + 25）"""
    with np.errstate(divide='ignore', invalid='ignore'):  # 处理log10的非正值
        return 5 * np.log10((C * z) / H0) + CONSTANT_TERM

def hubble_fit(z, mu, sigma_mu):
    """加权最小二乘拟合哈勃常数"""
    # 使用curve_fit进行加权拟合
    popt, pcov = curve_fit(
        hubble_model, z, mu, sigma=sigma_mu, absolute_sigma=True,
        bounds=(10, 200)  # 限制H0在合理范围（km/s/Mpc）
    )
    H0 = popt[0]
    H0_err = np.sqrt(pcov[0, 0])
    return H0, H0_err

def plot_hubble_diagram(z, mu, sigma_mu, H0, H0_err):
    """绘制哈勃图"""
    plt.figure(figsize=(10, 6))
    # 绘制数据点及误差棒
    plt.errorbar(z, mu, yerr=sigma_mu, fmt='o', color='blue', ecolor='gray', 
                 label='Supernova Data', capsize=5, alpha=0.7)
    # 绘制最佳拟合曲线
    z_fit = np.linspace(z.min(), z.max(), 100)
    mu_fit = hubble_model(z_fit, H0)
    plt.plot(z_fit, mu_fit, 'r-', linewidth=2, label=f'Fit: H0 = {H0:.1f} ± {H0_err:.1f} km/s/Mpc')
    
    # 添加文本标注
    plt.text(0.05, 0.95, f'H0 = {H0:.1f} ± {H0_err:.1f} km/s/Mpc', 
             transform=plt.gca().transAxes, bbox=dict(facecolor='white', alpha=0.8))
    
    # 图表美化
    plt.title('Hubble Diagram (Distance Modulus vs Redshift)', fontsize=14)
    plt.xlabel('Redshift (z)', fontsize=12)
    plt.ylabel('Distance Modulus (μ)', fontsize=12)
    plt.grid(True, linestyle='--', alpha=0.7)
    plt.legend(loc='best')
    plt.tight_layout()
    plt.savefig('hubble_diagram.png')  # 保存图片
    plt.show()

# 主函数（示例调用）
if __name__ == "__main__":
    # 加载数据（假设数据文件为supernova_data.txt，用制表符分隔）
    z, mu, sigma_mu = load_supernova_data('supernova_data.txt')
    
    # 拟合哈勃常数
    H0, H0_err = hubble_fit(z, mu, sigma_mu)
    print(f"Fitted H0: {H0:.1f} ± {H0_err:.1f} km/s/Mpc")
    
    # 绘制哈勃图
    plot_hubble_diagram(z, mu, sigma_mu, H0, H0_err)

   
2. 提交`实验报告.md`: 需包含方法描述、结果分析和讨论, 包含所有插值结果和图表
